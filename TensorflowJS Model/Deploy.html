<!DOCTYPE html>
<html>
<head>
  <title>Prediksi Penyakit Daun Tanaman</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
</head>
<body>
  <h1>Prediksi Penyakit Daun Tanaman</h1>

  <input type="file" id="imageUpload" accept="image/*">
  <button onclick="predict()">Prediksi</button>

  <div id="result"></div>

  <script>
    async function loadModel() {
      const model = await tf.loadLayersModel('model.json');
      return model;
    }

    async function loadImage(imageUrl) {
      const image = await new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.src = imageUrl;
        img.onload = () => resolve(img);
        img.onerror = error => reject(error);
      });

      return tf.browser.fromPixels(image);
    }

    async function preprocessImage(image) {
      const resizedImage = tf.image.resizeBilinear(image, [224, 224]);
      const normalizedImage = resizedImage.div(255.0);
      const expandedImage = normalizedImage.expandDims();
      return expandedImage;
    }

    async function predict() {
      const imageUpload = document.getElementById('imageUpload');
      const resultDiv = document.getElementById('result');

      // Memuat model Plantcare
      const plantcareModel = await loadModel();

      // Memuat dan memproses gambar yang diunggah
      const file = imageUpload.files[0];
      const imageUrl = URL.createObjectURL(file);
      const image = await loadImage(imageUrl);
      const preprocessedImage = await preprocessImage(image);

      // Membuat prediksi menggunakan model Plantcare
      const predictions = await plantcareModel.predict(preprocessedImage).data();
      const maxPrediction = Math.max(...predictions);
      const predictedClassIndex = predictions.indexOf(maxPrediction);

      // Daftar kelas penyakit
      const classes = [
        'Apple scab',
        'Apple Black rot',
        'Apple Cedar apple rust',
 'Apple healthy',
 'Bean angular leaf spot',
 'Bean healthy',
 'Bean rust',
 'Blueberry healthy',
 'Cherry (including sour) Powdery mildew',
 'Cherry (including sour) healthy',
 'Corn (maize) Cercospora leaf spot Gray leaf spot',
 'Corn (maize) Common rust',
 'Corn (maize) Northern Leaf Blight',
 'Corn (maize) healthy',
 'Grape Black rot',
 'Grape Esca (Black Measles)',
 'Grape Leaf blight (Isariopsis Leaf Spot)',
 'Grape healthy',
 'Orange Haunglongbing (Citrus greening)',
 'Peach Bacterial spot',
 'Peach healthy',
 'Pepper bell Bacterial spot',
 'Pepper bell healthy',
 'Potato Early blight',
 'Potato Late blight',
 'Potato healthy',
 'Raspberry healthy',
 'Soybean healthy',
 'Squash Powdery mildew',
 'Strawberry Leaf scorch',
 'Strawberry healthy',
 'Tomato Bacterial spot',
 'Tomato Early blight',
 'Tomato Late blight',
 'Tomato leaf mold',
 'Tomato Septoria leaf spot',
 'Tomato Two spotted spider mites',
 'Tomato target spot',
 'Tomato Yellow leaf curl virus',
 'Tomato mosaic virus',
 'Tomato healthy'
        // Tambahkan kelas penyakit lain sesuai dengan model Anda (total 41 kelas)
      ];

      // Mengambil kelas yang diprediksi
      const predictedClass = classes[predictedClassIndex];

      // Menampilkan hasil prediksi
      resultDiv.innerText = `Hasil prediksi: ${predictedClass}`;
    }
  </script>
</body>
</html>
